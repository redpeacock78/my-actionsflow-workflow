on:
  rss:
    url:
      # 2.5次元の誘惑
      - https://shonenjumpplus.com/rss/series/10834108156661135927
      # 怪獣8号
      - https://shonenjumpplus.com/rss/series/13933686331674116114
      # ゲーミングお嬢様
      - https://shonenjumpplus.com/rss/series/13933686331681118994
jobs:
  post:
    name: Post RSS updates to the discord
    runs-on: ubuntu-latest
    steps:
      - name: Fix title
        id: title
        run: |
          fix_title=$(echo "${{ on.rss.outputs.title }}" | sed -e "s/&amp;/\&/g" | sed -e "s/&lt;/</g;s/&gt;/>/g;s/&quot;/\"/g;s/&apos;/'/g" | sed -e 's/*/\\\\*/g;s/_/\\\\_/g;s/~~/\\\\~~/g')
          echo "::set-output name=fix_title::${fix_title}"
      - name: Post
        run: |
          echo "${{ steps.title.outputs.fix_title }} ${{ on.rss.outputs.link }}"
          curl -X POST \
               -H  "Content-Type: application/json" \
               -d '{"content": "**${{ steps.title.outputs.fix_title }}** ${{ on.rss.outputs.link }}"}' \
               ${{ secrets.DISCORD_PRIVATE_MANGA_JUMP_PLUS }}
